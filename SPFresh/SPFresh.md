# SPFresh: Incremental In-Place Update for Billion-Scale Vector Search

## 核心思想

此前的ANNS系统在向量更新时，往往无法就地更新。图结构的ANNS系统插入新向量非常困难，而分区结构的ANNS系统经过大量更新后索引结构会劣化（向量直接插入现有分区，导致分区不平衡）。SPFresh之前的方案只能定期重建索引，或是采用二级索引定期合并。而SPFresh基于SPANN，设计了一套通过对向量分区进行合并和拆分的方案，并重新分配处于分区边界处的向量，从而实现向量索引的就地更新，无需定期重建也可保持索引结构的高效。

## LIRE协议（就地更新的算法）

该协议的目的是实现就地更新，并保持NPA性质（所有向量处于中心离自己最近的分区中）。协议支持以下操作：

- Insert和Delete：新向量直接插入到最近的分区中，删除向量直接从分区删除
- Merge：当分区中向量数量少于一个阈值时，删除该分区中心并将所有向量全部加入到（离被删除分区的中心）最近的分区中。这些被移动的向量需要进行Reassign，因为新加入的分区不一定是最近的。
- Split：当分区数量大于一个阈值时，把该分区拆分成2个（删除旧中心，增加2个中心），被拆分中心的向量和附近分区中的向量可能需要考虑Reassign。
- Reassign：将向量重新分配到最近的分区中。

### 